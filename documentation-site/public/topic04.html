<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ch·ªß ƒë·ªÅ 4: Transaction Management - Qu·∫£n l√Ω giao d·ªãch</title>
    <!-- Tailwind CSS via CDN for simplicity and reliability -->
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom Scrollbar for Sidebar */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        html {
            scroll-behavior: smooth;
        }
    </style>
    <script>
      function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        sidebar.classList.toggle("-translate-x-full");
      }
    </script>
  </head>
  <body class="bg-slate-50 text-slate-900 antialiased flex flex-col min-h-screen">
    <!-- Header -->
    <header class="bg-white border-b border-gray-200 sticky top-0 z-30">
      <div
        class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between"
      >
        <div class="flex items-center">
          <button
            onclick="toggleSidebar()"
            class="lg:hidden p-2 rounded-md text-gray-600 hover:bg-gray-100"
          >
            <svg
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16"
              />
            </svg>
          </button>
          <a
            href="index.html"
            class="ml-3 lg:ml-0 text-xl font-bold text-gray-900 tracking-tight"
          >
            <span class="text-indigo-600">Spring Boot</span> for Frontend Devs
          </a>
        </div>
        <!-- Optional Top Links -->
        <div class="hidden md:flex space-x-4">
          <a
            href="https://github.com/simplesoft-duongdt3/chu-duong-courses"
            target="_blank"
            class="text-gray-500 hover:text-gray-900 transition font-medium"
            >GitHub</a
          >
        </div>
      </div>
    </header>

    <div class="flex-1 max-w-7xl w-full mx-auto flex items-start">
      <!-- Sidebar Navigation -->
      <!-- Sidebar Navigation -->
      <aside
        id="sidebar"
        class="fixed inset-0 z-50 bg-white transform -translate-x-full transition-transform duration-300 ease-in-out lg:translate-x-0 lg:static lg:z-0 lg:w-64 lg:h-[calc(100vh-4rem)] lg:bg-transparent lg:border-r lg:border-gray-200 lg:sticky lg:top-16 overflow-y-auto"
      >
        <div class="p-4 flex justify-between items-center lg:hidden border-b border-gray-100 mb-2">
            <span class="font-bold text-gray-900">Menu</span>
            <button onclick="toggleSidebar()" class="p-2 -mr-2 text-gray-500 hover:text-gray-700">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
        <nav class="p-4 space-y-1">
          <div class="mb-4">
            <p
              class="px-2 text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2"
            >
              Ch∆∞∆°ng tr√¨nh h·ªçc
            </p>
            <a href="index.html" class="block px-2 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 group flex items-center">
            Spring Boot for Frontend Devs
        </a>
<a href="topic01.html" class="block px-2 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 group flex items-center">
            Ch·ªß ƒë·ªÅ 1: Request-Response Cycle & The Middleware Chain
        </a>
<a href="topic02.html" class="block px-2 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 group flex items-center">
            Ch·ªß ƒë·ªÅ 2: IoC Container & Dependency Injection (DI)
        </a>
<a href="topic03.html" class="block px-2 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 group flex items-center">
            Ch·ªß ƒë·ªÅ 3: Persistence v·ªõi Spring Data JPA & Hibernate
        </a>
<a href="topic04.html" class="block px-2 py-2 text-sm font-medium text-indigo-600 bg-indigo-50 rounded-md hover:bg-gray-100 group flex items-center">
            Ch·ªß ƒë·ªÅ 4: Transaction Management - Qu·∫£n l√Ω giao d·ªãch
        </a>
<a href="topic05.html" class="block px-2 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 group flex items-center">
            Ch·ªß ƒë·ªÅ 5: Validation & Global Exception Handling
        </a>
<a href="topic06.html" class="block px-2 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 group flex items-center">
            Ch·ªß ƒë·ªÅ 6: Spring Security & JWT (Stateless Authentication)
        </a>
<a href="topic07.html" class="block px-2 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 group flex items-center">
            Ch·ªß ƒë·ªÅ 7: Logging & Monitoring (Actuator)
        </a>
<a href="topic08.html" class="block px-2 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 group flex items-center">
            Ch·ªß ƒë·ªÅ 8: üìò C·∫©m Nang To√†n T·∫≠p: JPA Relationships & Migration
        </a>
<a href="topic09.html" class="block px-2 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 group flex items-center">
            Ch·ªß ƒë·ªÅ 9: Concurrency & Multi-threading
        </a>
<a href="topic10.html" class="block px-2 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 group flex items-center">
            Ch·ªß ƒë·ªÅ 10: Audit Log - Camera gi√°m s√°t Database
        </a>
<a href="topic11.html" class="block px-2 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 group flex items-center">
            Ch·ªß ƒë·ªÅ 11: External API Call & Backend For Frontend (BFF)
        </a>
<a href="topic_best_practices.html" class="block px-2 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 group flex items-center">
            Spring Boot 3 Best Practices (The Pro Checklist)
        </a>
<a href="topic_black_holes.html" class="block px-2 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 group flex items-center">
            üõ°Ô∏è Spring Boot 3 Survival Guide: 12 "Black Holes" & Deep Debugging
        </a>
          </div>
        </nav>
      </aside>

      <!-- Main Content -->
      <main class="flex-1 min-w-0 p-4 sm:p-6 lg:padding-8">
        <div class="max-w-4xl mx-auto">
          <article
            class="prose prose-slate prose-lg max-w-none prose-headings:font-bold prose-a:text-indigo-600 hover:prose-a:text-indigo-500 prose-img:rounded-xl shadow-none"
          >
            <h2>Transaction Management. ƒê√¢y l√† n∆°i ranh gi·ªõi gi·ªØa m·ªôt &quot;Junior&quot; v√† m·ªôt &quot;Senior&quot; Backend ƒë∆∞·ª£c ph√¢n ƒë·ªãnh r√µ r√†ng nh·∫•t.</h2>
<p>N·∫øu ·ªü Frontend, b·∫°n g·ªçi 3 API li√™n ti·∫øp v√† c√°i th·ª© 2 b·ªã l·ªói, b·∫°n th∆∞·ªùng ph·∫£i vi·∫øt logic ƒë·ªÉ &quot;undo&quot; c√°i th·ª© nh·∫•t (ho·∫∑c m·∫∑c k·ªá n√≥). Trong Spring Boot, ch√∫ng ta c√≥ <strong>Transaction</strong> ƒë·ªÉ ƒë·∫£m b·∫£o m·ªçi th·ª© di·ªÖn ra theo quy t·∫Øc: <strong>&quot;ƒê∆∞·ª£c ƒÉn c·∫£, ng√£ v·ªÅ kh√¥ng&quot;</strong>.</p>
<hr>
<h1>Ch·ªß ƒë·ªÅ 4: Transaction Management - Qu·∫£n l√Ω giao d·ªãch</h1>
<h3>1. L√Ω thuy·∫øt: ACID v√† Ph√©p m√†u c·ªßa Proxy</h3>
<p>Trong Backend, m·ªôt &quot;Transaction&quot; (Giao d·ªãch) l√† m·ªôt ƒë∆°n v·ªã c√¥ng vi·ªác kh√¥ng th·ªÉ chia c·∫Øt. N√≥ tu√¢n th·ªß t√≠nh ch·∫•t <strong>ACID</strong> (Atomicity, Consistency, Isolation, Durability).</p>
<ul>
<li><strong>@Transactional:</strong> L√† Annotation quy·ªÅn l·ª±c nh·∫•t. Khi b·∫°n ƒë√°nh d·∫•u m·ªôt h√†m v·ªõi <code>@Transactional</code>, Spring s·∫Ω t·∫°o m·ªôt <strong>Proxy</strong> (ng∆∞·ªùi ƒë·∫°i di·ªán) bao quanh h√†m ƒë√≥.</li>
<li>B·∫Øt ƒë·∫ßu h√†m: Proxy m·ªü m·ªôt k·∫øt n·ªëi t·ªõi DB v√† t·∫Øt ch·∫ø ƒë·ªô <code>auto-commit</code>.</li>
<li>H√†m ch·∫°y xong xu√¥i: Proxy g·ªçi <code>commit</code> ƒë·ªÉ l∆∞u vƒ©nh vi·ªÖn d·ªØ li·ªáu.</li>
<li>C√≥ l·ªói x·∫£y ra (Exception): Proxy g·ªçi <code>rollback</code> ƒë·ªÉ ƒë∆∞a d·ªØ li·ªáu v·ªÅ tr·∫°ng th√°i ban ƒë·∫ßu nh∆∞ ch∆∞a c√≥ chuy·ªán g√¨ x·∫£y ra.</li>
</ul>
<blockquote>
<p><strong>L∆∞u √Ω quan tr·ªçng cho Dev Frontend:</strong> M·∫∑c ƒë·ªãnh, Spring ch·ªâ Rollback khi g·∫∑p <strong>Unchecked Exception</strong> (nh∆∞ <code>RuntimeException</code>, <code>NullPointerException</code>). N·∫øu b·∫°n n√©m ra m·ªôt <strong>Checked Exception</strong> (nh∆∞ <code>IOException</code>, <code>SQLException</code>), n√≥ s·∫Ω <strong>KH√îNG</strong> rollback tr·ª´ khi b·∫°n c·∫•u h√¨nh th√™m.</p>
</blockquote>
<hr>
<h3>2. V√≠ d·ª• Code &amp; C·∫•u h√¨nh</h3>
<h4>A. C√°ch d√πng c∆° b·∫£n (Thanh to√°n ƒë∆°n h√†ng)</h4>
<p>Gi·∫£ s·ª≠ b·∫°n c·∫ßn tr·ª´ ti·ªÅn kh√°ch h√†ng v√† tr·ª´ kho h√†ng c√πng l√∫c.</p>
<pre><code class="language-java">@Service
public class OrderService {

    @Autowired private WalletRepository walletRepository;
    @Autowired private StockRepository stockRepository;

    @Transactional(rollbackFor = Exception.class) // Rollback cho m·ªçi lo·∫°i l·ªói
    public void placeOrder(Long userId, Long productId, Double amount) {
        // 1. Tr·ª´ ti·ªÅn v√≠
        walletRepository.deductMoney(userId, amount);

        // 2. Gi·∫£ s·ª≠ ƒëo·∫°n n√†y b·ªã l·ªói (v√≠ d·ª•: m·∫•t ƒëi·ªán, DB ngh·∫Ωn)
        if (true) throw new RuntimeException(&quot;L·ªói b·∫•t ng·ªù!&quot;); 

        // 3. Tr·ª´ kho (D√≤ng n√†y s·∫Ω kh√¥ng bao gi·ªù ch·∫°y)
        stockRepository.decreaseStock(productId);
        
        // Nh·ªù @Transactional, ti·ªÅn trong v√≠ ·ªü b∆∞·ªõc 1 s·∫Ω ƒë∆∞·ª£c ho√†n l·∫°i t·ª± ƒë·ªông!
    }
}
</code></pre>
<h4>B. C·∫•u h√¨nh Isolation &amp; Propagation (N√¢ng cao)</h4>
<p>ƒê√¥i khi b·∫°n mu·ªën m·ªôt h√†m ch·∫°y trong m·ªôt Transaction m·ªõi ho√†n to√†n, ƒë·ªôc l·∫≠p v·ªõi h√†m g·ªçi n√≥.</p>
<pre><code class="language-java">@Transactional(propagation = Propagation.REQUIRES_NEW)
public void logToDatabase(String message) {
    // Lu√¥n l∆∞u Log v√†o DB, k·ªÉ c·∫£ khi giao d·ªãch ch√≠nh b·ªã th·∫•t b·∫°i v√† rollback
}
</code></pre>
<hr>
<h3>3. T√¨nh hu·ªëng th·ª±c t·∫ø (Real-world Scenarios)</h3>
<p><strong>T√¨nh hu·ªëng 1: L·ªói &quot;Self-invocation&quot; (T·ª± g·ªçi ch√≠nh m√¨nh)</strong></p>
<ul>
<li><strong>V·∫•n ƒë·ªÅ:</strong> B·∫°n c√≥ h√†m <code>A()</code> (kh√¥ng c√≥ Transaction) g·ªçi h√†m <code>B()</code> (c√≥ <code>@Transactional</code>) trong c√πng m·ªôt Class.</li>
<li><strong>K·∫øt qu·∫£:</strong> Transaction ·ªü h√†m <code>B()</code> s·∫Ω <strong>kh√¥ng ho·∫°t ƒë·ªông</strong>.</li>
<li><strong>L√Ω do:</strong> Spring d√πng Proxy ƒë·ªÉ b·ªçc Class l·∫°i. Khi g·ªçi n·ªôi b·ªô (internal call), n√≥ kh√¥ng ƒëi qua Proxy n√™n kh√¥ng c√≥ ph√©p m√†u n√†o x·∫£y ra c·∫£. ƒê√¢y l√† l·ªói &quot;v·ª° l√≤ng&quot; m√† h·∫ßu nh∆∞ dev n√†o c≈©ng d√≠nh.</li>
</ul>
<p><strong>T√¨nh hu·ªëng 2: Giao d·ªãch v·ªõi b√™n th·ª© ba (Third-party API)</strong></p>
<ul>
<li><strong>V·∫•n ƒë·ªÅ:</strong> B·∫°n g·ªçi API c·ªßa PayPal ƒë·ªÉ tr·ª´ ti·ªÅn, sau ƒë√≥ c·∫≠p nh·∫≠t DB c·ªßa m√¨nh. N·∫øu c·∫≠p nh·∫≠t DB l·ªói, Spring s·∫Ω rollback DB c·ªßa b·∫°n, nh∆∞ng <strong>kh√¥ng th·ªÉ</strong> ƒë√≤i l·∫°i ti·ªÅn t·ª´ PayPal.</li>
<li><strong>Gi·∫£i ph√°p:</strong> Lu√¥n g·ªçi c√°c d·ªãch v·ª• b√™n ngo√†i <strong>cu·ªëi c√πng</strong> ho·∫∑c s·ª≠ d·ª•ng m√¥ h√¨nh <strong>Saga Pattern/Two-phase Commit</strong> n·∫øu h·ªá th·ªëng c·ª±c k·ª≥ ph·ª©c t·∫°p. ƒê·ª´ng bao gi·ªù ƒë·ªÉ API g·ªçi ngo√†i n·∫±m gi·ªØa c√°c c√¢u l·ªánh c·∫≠p nh·∫≠t DB nh·∫°y c·∫£m.</li>
</ul>
<p><strong>T√¨nh hu·ªëng 3: Read-only Optimization</strong></p>
<ul>
<li><strong>V·∫•n ƒë·ªÅ:</strong> B·∫°n ch·ªâ mu·ªën l·∫•y d·ªØ li·ªáu ƒë·ªÉ hi·ªÉn th·ªã (Dashboard).</li>
<li><strong>Gi·∫£i ph√°p:</strong> D√πng <code>@Transactional(readOnly = true)</code>.</li>
<li><strong>L·ª£i √≠ch:</strong> Hibernate s·∫Ω t·∫Øt t√≠nh nƒÉng &quot;Dirty checking&quot; (ki·ªÉm tra thay ƒë·ªïi object), gi√∫p API c·ªßa b·∫°n ch·∫°y nhanh h∆°n v√† gi·∫£m t·∫£i cho Database (DB c√≥ th·ªÉ ƒëi·ªÅu h∆∞·ªõng sang Node Read-only).</li>
</ul>
<hr>
<h3>B·∫£ng so s√°nh cho d·ªÖ nh·ªõ</h3>
<table>
<thead>
<tr>
<th>ƒê·∫∑c ƒëi·ªÉm</th>
<th>Kh√¥ng d√πng Transaction</th>
<th>C√≥ d√πng @Transactional</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Khi l·ªói x·∫£y ra</strong></td>
<td>D·ªØ li·ªáu d·ªü dang (Inconsistent)</td>
<td>D·ªØ li·ªáu s·∫°ch s·∫Ω (Rollback)</td>
</tr>
<tr>
<td><strong>Hi·ªáu nƒÉng</strong></td>
<td>Nhanh h∆°n m·ªôt ch√∫t</td>
<td>T·ªën th√™m ph√≠ qu·∫£n l√Ω k·∫øt n·ªëi</td>
</tr>
<tr>
<td><strong>T∆∞ duy</strong></td>
<td>&quot;L·ªói ƒë√¢u s·ª≠a ƒë·∫•y&quot;</td>
<td>&quot;T·∫•t c·∫£ ho·∫∑c kh√¥ng g√¨ c·∫£&quot;</td>
</tr>
<tr>
<td><strong>Ph√π h·ª£p</strong></td>
<td>C√°c t√°c v·ª• ƒë·ªçc, log ƒë∆°n gi·∫£n</td>
<td>Thanh to√°n, ƒêƒÉng k√Ω, ƒê·ªïi m·∫≠t kh·∫©u</td>
</tr>
</tbody></table>
<hr>
<h3>‚ö†Ô∏è C·∫°m b·∫´y c·∫ßn tr√°nh:</h3>
<p>ƒê·ª´ng bao gi·ªù ƒë·ªÉ c√°c t√°c v·ª• n·∫∑ng (nh∆∞ g·ª≠i Email, upload file l√™n S3, x·ª≠ l√Ω ·∫£nh) b√™n trong <code>@Transactional</code>. N√≥ s·∫Ω gi·ªØ k·∫øt n·ªëi Database (Connection) r·∫•t l√¢u, khi·∫øn ·ª©ng d·ª•ng h·∫øt k·∫øt n·ªëi v√† b·ªã treo (Connection Pool Exhaustion).</p>
<hr>
<p>L·ªói <strong>Self-invocation</strong> l√† m·ªôt trong nh·ªØng &quot;h·ªë ƒëen&quot; khi·∫øn nhi·ªÅu Developer m·∫•t h√†ng gi·ªù debug v√¨ code nh√¨n ho√†n to√†n ƒë√∫ng nh∆∞ng Transaction l·∫°i kh√¥ng ho·∫°t ƒë·ªông.</p>
<p>ƒê·ªÉ hi·ªÉu r√µ, b·∫°n c·∫ßn nh·ªõ m·ªôt nguy√™n t·∫Øc v√†ng: <strong>Spring kh√¥ng tr·ª±c ti·∫øp ch·∫°y class c·ªßa b·∫°n, n√≥ ch·∫°y m·ªôt &quot;b·∫£n sao gi·∫£&quot; (Proxy) bao quanh class ƒë√≥.</strong></p>
<hr>
<h1>Hi·ªÉu s√¢u v·ªÅ Self-invocation &amp; Proxy Pattern</h1>
<h3>1. B·∫£n ch·∫•t: Hi·ªáu ·ª©ng &quot;V∆∞·ª£t r√†o&quot;</h3>
<p>H√£y t∆∞·ªüng t∆∞·ª£ng Class c·ªßa b·∫°n l√† m·ªôt <strong>C·ª≠a h√†ng</strong>. <code>@Transactional</code> gi·ªëng nh∆∞ m·ªôt <strong>anh b·∫£o v·ªá</strong> ƒë·ª©ng ·ªü c·ª≠a ch√≠nh.</p>
<ul>
<li><strong>External Call:</strong> M·ªôt v·ªã kh√°ch (Controller) ƒëi t·ª´ ngo√†i v√†o c·ª≠a ch√≠nh -&gt; G·∫∑p b·∫£o v·ªá -&gt; B·∫£o v·ªá m·ªü Transaction -&gt; Kh√°ch v√†o mua h√†ng.</li>
<li><strong>Self-invocation:</strong> B·∫°n ƒëang ·ªü trong kho (H√†m A), b·∫°n t·ª± ƒëi sang qu·∫ßy thu ng√¢n (H√†m B) m√† kh√¥ng ƒëi ra ngo√†i r·ªìi quay l·∫°i c·ª≠a ch√≠nh -&gt; <strong>B·∫°n kh√¥ng ƒëi qua anh b·∫£o v·ªá</strong> -&gt; Kh√¥ng c√≥ Transaction n√†o ƒë∆∞·ª£c m·ªü.</li>
</ul>
<hr>
<h3>2. V√≠ d·ª• Code g√¢y l·ªói</h3>
<pre><code class="language-java">@Service
public class OrderService {

    // H√†m n√†y KH√îNG c√≥ Transaction
    public void createOrderSimple(Order order) {
        // ... logic ki·ªÉm tra ƒë∆°n h√†ng
        saveOrderWithTransaction(order); // T·ª± g·ªçi h√†m trong c√πng class (Self-invocation)
    }

    // H√†m n√†y C√ì Transaction
    @Transactional
    public void saveOrderWithTransaction(Order order) {
        repository.save(order);
        // N·∫øu c√≥ l·ªói ·ªü ƒë√¢y, n√≥ s·∫Ω KH√îNG ROLLBACK 
        // v√¨ h√†m n√†y ƒë∆∞·ª£c g·ªçi tr·ª±c ti·∫øp, bypass qua Proxy c·ªßa Spring.
    }
}
</code></pre>
<hr>
<h3>3. C√°ch x·ª≠ l√Ω (Solutions)</h3>
<p>C√≥ 3 c√°ch ph·ªï bi·∫øn ƒë·ªÉ &quot;v√°&quot; l·ªói n√†y, s·∫Øp x·∫øp theo th·ª© t·ª± t·ª´ &quot;S·∫°ch&quot; ƒë·∫øn &quot;T·∫°m b·ª£&quot;:</p>
<h4>C√°ch 1: T√°ch Service (Khuy√™n d√πng - Clean Code)</h4>
<p>ƒê∆∞a h√†m c√≥ Transaction sang m·ªôt Service kh√°c. ƒê√¢y l√† c√°ch tu√¢n th·ªß Single Responsibility Principle (SRP).</p>
<pre><code class="language-java">@Service
@RequiredArgsConstructor
public class OrderService {
    private final OrderDbService orderDbService; // Inject service kh√°c

    public void createOrder(Order order) {
        // ... logic
        orderDbService.save(order); // G·ªçi sang Proxy c·ªßa Service kh√°c -&gt; OK!
    }
}

@Service
public class OrderDbService {
    @Transactional
    public void save(Order order) {
        repository.save(order);
    }
}
</code></pre>
<h4>C√°ch 2: T·ª± Inject ch√≠nh m√¨nh (Self-Injection)</h4>
<p>Spring Boot cho ph√©p b·∫°n &quot;ti√™m&quot; ch√≠nh c√°i Proxy c·ªßa m√¨nh v√†o b√™n trong. C√°ch n√†y h∆°i &quot;k·ª≥ c·ª•c&quot; v·ªÅ m·∫∑t th·∫©m m·ªπ nh∆∞ng c·ª±c k·ª≥ hi·ªáu qu·∫£.</p>
<pre><code class="language-java">@Service
public class OrderService {
    @Autowired
    @Lazy // D√πng @Lazy ƒë·ªÉ tr√°nh l·ªói l·∫∑p v√≤ng kh·ªüi t·∫°o (Circular Dependency)
    private OrderService self;

    public void createOrder(Order order) {
        self.saveOrderWithTransaction(order); // G·ªçi qua bi·∫øn &#39;self&#39; (ch√≠nh l√† Proxy) -&gt; OK!
    }

    @Transactional
    public void saveOrderWithTransaction(Order order) {
        repository.save(order);
    }
}
</code></pre>
<h4>C√°ch 3: S·ª≠ d·ª•ng TransactionTemplate (L·∫≠p tr√¨nh th·ªß c√¥ng)</h4>
<p>N·∫øu b·∫°n kh√¥ng mu·ªën d√πng Annotation, b·∫°n c√≥ th·ªÉ t·ª± qu·∫£n l√Ω Transaction b·∫±ng code. C√°ch n√†y gi·ªëng nh∆∞ c√°ch b·∫°n d√πng <code>try-catch</code> trong JavaScript.</p>
<pre><code class="language-java">@Service
public class OrderService {
    @Autowired private TransactionTemplate transactionTemplate;

    public void createOrder(Order order) {
        transactionTemplate.execute(status -&gt; {
            repository.save(order); // Ch·∫°y trong Transaction th·ªß c√¥ng
            return null;
        });
    }
}
</code></pre>
<hr>
<h3>4. C√°c t√¨nh hu·ªëng th·ª±c t·∫ø hay g·∫∑p</h3>
<p><strong>T√¨nh hu·ªëng 1: Cache kh√¥ng ho·∫°t ƒë·ªông (@Cacheable)</strong></p>
<ul>
<li><strong>V·∫•n ƒë·ªÅ:</strong> B·∫°n d√πng <code>@Cacheable</code> ƒë·ªÉ l∆∞u k·∫øt qu·∫£ API v√†o Redis. Nh∆∞ng b·∫°n l·∫°i g·ªçi h√†m ƒë√≥ t·ª´ m·ªôt h√†m kh√°c c√πng class.</li>
<li><strong>K·∫øt qu·∫£:</strong> Spring kh√¥ng bao gi·ªù ki·ªÉm tra Redis m√† lu√¥n ch·∫°y th·∫≥ng v√†o Database.</li>
<li><strong>L√Ω do:</strong> Gi·ªëng h·ªát <code>@Transactional</code>, <code>@Cacheable</code> c≈©ng d·ª±a tr√™n Proxy.</li>
</ul>
<p><strong>T√¨nh hu·ªëng 2: Ch·∫°y b·∫•t ƒë·ªìng b·ªô b·ªã treo (@Async)</strong></p>
<ul>
<li><strong>V·∫•n ƒë·ªÅ:</strong> B·∫°n mu·ªën h√†m g·ª≠i Email ch·∫°y ng·∫ßm (<code>@Async</code>) ƒë·ªÉ kh√¥ng b·∫Øt Frontend ch·ªù l√¢u. B·∫°n g·ªçi h√†m <code>@Async</code> t·ª´ m·ªôt h√†m kh√°c trong c√πng Service.</li>
<li><strong>K·∫øt qu·∫£:</strong> Email v·∫´n ch·∫°y ƒë·ªìng b·ªô, Frontend v·∫´n ph·∫£i ch·ªù &quot;d√†i c·ªï&quot;.</li>
<li><strong>L√Ω do:</strong> Proxy kh√¥ng can thi·ªáp ƒë∆∞·ª£c ƒë·ªÉ ƒë·∫©y h√†m ƒë√≥ v√†o Thread Pool ri√™ng.</li>
</ul>
<p><strong>T√¨nh hu·ªëng 3: B·∫£o m·∫≠t b·ªã b·ªè qua (@PreAuthorize)</strong></p>
<ul>
<li><strong>V·∫•n ƒë·ªÅ:</strong> B·∫°n check quy·ªÅn admin b·∫±ng <code>@PreAuthorize(&quot;hasRole(&#39;ADMIN&#39;)&quot;)</code>.</li>
<li><strong>K·∫øt qu·∫£:</strong> User th∆∞·ªùng v·∫´n g·ªçi ƒë∆∞·ª£c h√†m admin n·∫øu h·ªç g·ªçi th√¥ng qua m·ªôt h√†m &quot;public&quot; kh√°c trong c√πng class. ƒê√¢y l√† m·ªôt l·ªó h·ªïng b·∫£o m·∫≠t c·ª±c k·ª≥ nguy hi·ªÉm.</li>
</ul>
<hr>
<h3>T√≥m t·∫Øt &quot;b·ªè t√∫i&quot; cho b·∫°n</h3>
<table>
<thead>
<tr>
<th>ƒê·∫∑c ƒëi·ªÉm</th>
<th>G·ªçi t·ª´ ngo√†i (External)</th>
<th>G·ªçi n·ªôi b·ªô (Self-invocation)</th>
</tr>
</thead>
<tbody><tr>
<td><strong>ƒêi qua Proxy?</strong></td>
<td>C√≥</td>
<td><strong>Kh√¥ng</strong></td>
</tr>
<tr>
<td><strong>Annotation c√≥ t√°c d·ª•ng?</strong></td>
<td>C√≥</td>
<td><strong>M·∫•t t√°c d·ª•ng</strong></td>
</tr>
<tr>
<td><strong>Gi·∫£i ph√°p t·ªët nh·∫•t</strong></td>
<td>Gi·ªØ nguy√™n</td>
<td>T√°ch Service</td>
</tr>
</tbody></table>
<hr>
<p><strong>L·ªùi khuy√™n:</strong> Khi b·∫°n th·∫•y m·ªôt Annotation c·ªßa Spring (nh∆∞ <code>@Transactional</code>, <code>@Async</code>, <code>@Cacheable</code>, <code>@Secured</code>) b·ªóng nhi√™n &quot;bi·∫øn m·∫•t&quot; kh√¥ng r√µ l√Ω do, h√£y ki·ªÉm tra ngay xem b·∫°n c√≥ ƒëang g·ªçi n·ªôi b·ªô hay kh√¥ng.</p>

          </article>

          <!-- Navigation Footer (Next/Prev) -->
          <div class="mt-12 pt-8 border-t border-gray-200 flex justify-between">
            <a href="topic03.html" class="text-indigo-600 font-medium hover:text-indigo-800">‚Üê Ch·ªß ƒë·ªÅ 3: Persistence v·ªõi Spring Data JPA & Hibernate</a><a href="topic05.html" class="text-indigo-600 font-medium hover:text-indigo-800">Ch·ªß ƒë·ªÅ 5: Validation & Global Exception Handling ‚Üí</a>
          </div>
        </div>
      </main>
    </div>

    <!-- Overlay for mobile sidebar -->
    <div
      onclick="toggleSidebar()"
      id="overlay"
      class="fixed inset-0 bg-black/50 z-10 lg:hidden hidden"
      style="display: none"
    ></div>
    <script>
      // Simple overlay logic
      const sidebar = document.getElementById("sidebar");
      const overlay = document.getElementById("overlay");

      // Sync overlay with sidebar state check if needed, but for "simplest" just toggle visibility in CSS or JS.
      // Actually, let's keep it simple.
    </script>
  </body>
</html>
