<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ğŸ›¡ï¸ Spring Boot 3 Survival Guide: 12 "Black Holes" & Deep Debugging</title>
    <!-- Tailwind CSS via CDN for simplicity and reliability -->
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom Scrollbar for Sidebar */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        html {
            scroll-behavior: smooth;
        }
    </style>
    <script>
      function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        sidebar.classList.toggle("-translate-x-full");
      }
    </script>
  </head>
  <body class="bg-slate-50 text-slate-900 antialiased flex flex-col min-h-screen">
    <!-- Header -->
    <header class="bg-white border-b border-gray-200 sticky top-0 z-30">
      <div
        class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between"
      >
        <div class="flex items-center">
          <button
            onclick="toggleSidebar()"
            class="lg:hidden p-2 rounded-md text-gray-600 hover:bg-gray-100"
          >
            <svg
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16"
              />
            </svg>
          </button>
          <a
            href="index.html"
            class="ml-3 lg:ml-0 text-xl font-bold text-gray-900 tracking-tight"
          >
            <span class="text-indigo-600">Spring Boot</span> for Frontend Devs
          </a>
        </div>
        <!-- Optional Top Links -->
        <div class="hidden md:flex space-x-4">
          <a
            href="https://github.com/chu-duong-courses"
            target="_blank"
            class="text-gray-500 hover:text-gray-900 transition font-medium"
            >GitHub</a
          >
        </div>
      </div>
    </header>

    <div class="flex-1 max-w-7xl w-full mx-auto flex items-start">
      <!-- Sidebar Navigation -->
      <!-- Sidebar Navigation -->
      <aside
        id="sidebar"
        class="fixed inset-0 z-50 bg-white transform -translate-x-full transition-transform duration-300 ease-in-out lg:translate-x-0 lg:static lg:z-0 lg:w-64 lg:h-[calc(100vh-4rem)] lg:bg-transparent lg:border-r lg:border-gray-200 lg:sticky lg:top-16 overflow-y-auto"
      >
        <div class="p-4 flex justify-between items-center lg:hidden border-b border-gray-100 mb-2">
            <span class="font-bold text-gray-900">Menu</span>
            <button onclick="toggleSidebar()" class="p-2 -mr-2 text-gray-500 hover:text-gray-700">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
        <nav class="p-4 space-y-1">
          <div class="mb-4">
            <p
              class="px-2 text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2"
            >
              ChÆ°Æ¡ng trÃ¬nh há»c
            </p>
            <a href="index.html" class="block px-2 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 group flex items-center">
            Spring Boot for Frontend Devs
        </a>
<a href="topic01.html" class="block px-2 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 group flex items-center">
            Chá»§ Ä‘á» 1: Request-Response Cycle & The Middleware Chain
        </a>
<a href="topic02.html" class="block px-2 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 group flex items-center">
            Chá»§ Ä‘á» 2: IoC Container & Dependency Injection (DI)
        </a>
<a href="topic03.html" class="block px-2 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 group flex items-center">
            Chá»§ Ä‘á» 3: Persistence vá»›i Spring Data JPA & Hibernate
        </a>
<a href="topic04.html" class="block px-2 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 group flex items-center">
            Chá»§ Ä‘á» 4: Transaction Management - Quáº£n lÃ½ giao dá»‹ch
        </a>
<a href="topic05.html" class="block px-2 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 group flex items-center">
            Chá»§ Ä‘á» 5: Validation & Global Exception Handling
        </a>
<a href="topic06.html" class="block px-2 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 group flex items-center">
            Chá»§ Ä‘á» 6: Spring Security & JWT (Stateless Authentication)
        </a>
<a href="topic07.html" class="block px-2 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 group flex items-center">
            Chá»§ Ä‘á» 7: Logging & Monitoring (Actuator)
        </a>
<a href="topic08.html" class="block px-2 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 group flex items-center">
            ğŸ“˜ Cáº©m Nang ToÃ n Táº­p: JPA Relationships & Migration (2026 Edition)
        </a>
<a href="topic_black_holes.html" class="block px-2 py-2 text-sm font-medium text-indigo-600 bg-indigo-50 rounded-md hover:bg-gray-100 group flex items-center">
            ğŸ›¡ï¸ Spring Boot 3 Survival Guide: 12 "Black Holes" & Deep Debugging
        </a>
          </div>
        </nav>
      </aside>

      <!-- Main Content -->
      <main class="flex-1 min-w-0 p-4 sm:p-6 lg:padding-8">
        <div class="max-w-4xl mx-auto">
          <article
            class="prose prose-slate prose-lg max-w-none prose-headings:font-bold prose-a:text-indigo-600 hover:prose-a:text-indigo-500 prose-img:rounded-xl shadow-none"
          >
            <h1>ğŸ›¡ï¸ Spring Boot 3 Survival Guide: 12 &quot;Black Holes&quot; &amp; Deep Debugging</h1>
<p>TÃ i liá»‡u nÃ y tá»•ng há»£p 12 lá»—i logic &quot;ngáº§m&quot; cá»±c ká»³ phá»• biáº¿n trong Spring Boot 3, giáº£i thÃ­ch tá»« gá»‘c rá»… cÆ¡ cháº¿ (Proxy, Threading, Hibernate) kÃ¨m code máº«u vÃ  giáº£i phÃ¡p.</p>
<hr>
<h2>1. Self-invocation (Tá»± gá»i ná»™i bá»™)</h2>
<h3>ğŸ“– LÃ½ thuyáº¿t chuyÃªn sÃ¢u</h3>
<p>Spring sá»­ dá»¥ng <strong>AOP (Aspect Oriented Programming)</strong> dá»±a trÃªn cÆ¡ cháº¿ <strong>Proxy</strong>. Khi má»™t Bean Ä‘Æ°á»£c táº¡o ra, Spring khÃ´ng tráº£ vá» instance thá»±c mÃ  tráº£ vá» má»™t &quot;vá» bá»c&quot; (Proxy).</p>
<ul>
<li><strong>CÆ¡ cháº¿:</strong> Khi gá»i tá»« bÃªn ngoÃ i, Proxy sáº½ Ä‘Ã¡nh cháº·n (intercept) Ä‘á»ƒ thá»±c hiá»‡n logic phá»¥ (má»Ÿ Transaction, kiá»ƒm tra Cache).</li>
<li><strong>Há»‘ Ä‘en:</strong> Náº¿u gá»i ná»™i bá»™ (<code>this.method()</code>), báº¡n Ä‘ang gá»i trá»±c tiáº¿p vÃ o instance thá»±c, bá» qua hoÃ n toÃ n Proxy. Do Ä‘Ã³, cÃ¡c Annotation trÃªn method bá»‹ gá»i sáº½ vÃ´ hiá»‡u.</li>
</ul>
<h3>âŒ Code lá»—i</h3>
<pre><code class="language-java">@Service
public class UserService {
    public void register() {
        saveData(); // Gá»i ná»™i bá»™: Transaction bá»‹ phá»›t lá» hoÃ n toÃ n!
    }

    @Transactional
    public void saveData() { /* LÆ°u DB */ }
}
</code></pre>
<h3>âœ… CÃ¡ch fix</h3>
<p><strong>CÃ¡ch 1 (KhuyÃªn dÃ¹ng):</strong> TÃ¡ch logic sang má»™t Service khÃ¡c.<br><strong>CÃ¡ch 2 (Self-injection):</strong> Tá»± inject chÃ­nh mÃ¬nh Ä‘á»ƒ gá»i qua Proxy.</p>
<pre><code class="language-java">@Service
public class UserService {
    @Autowired @Lazy private UserService self;

    public void register() {
        self.saveData(); // Gá»i qua Proxy thÃ nh cÃ´ng
    }
}
</code></pre>
<hr>
<h2>2. @Transactional &amp; Checked Exception</h2>
<h3>ğŸ“– LÃ½ thuyáº¿t chuyÃªn sÃ¢u</h3>
<p>Theo thiáº¿t káº¿ máº·c Ä‘á»‹nh cá»§a Spring (káº¿ thá»«a tá»« chuáº©n EJB), há»‡ thá»‘ng chá»‰ tá»± Ä‘á»™ng rollback khi gáº·p <strong>Unchecked Exception</strong> (<code>RuntimeException</code> vÃ  <code>Error</code>). CÃ¡c <strong>Checked Exception</strong> (nhá»¯ng lá»—i báº¯t buá»™c pháº£i <code>try-catch</code> hoáº·c <code>throws</code>) Ä‘Æ°á»£c coi lÃ  lá»—i nghiá»‡p vá»¥ mÃ  láº­p trÃ¬nh viÃªn pháº£i tá»± xá»­ lÃ½, nÃªn Spring sáº½ váº«n <strong>Commit</strong> dá»¯ liá»‡u.</p>
<h3>âŒ Code lá»—i</h3>
<pre><code class="language-java">@Transactional
public void processOrder() throws IOException {
    repo.save(order);
    if (fileError) throw new IOException(&quot;Lá»—i lÆ°u file&quot;); // DB váº«n commit dÃ¹ throw lá»—i!
}
</code></pre>
<h3>âœ… CÃ¡ch fix</h3>
<pre><code class="language-java">@Transactional(rollbackFor = Exception.class) // Rollback cho má»i loáº¡i Exception
</code></pre>
<hr>
<h2>3. &quot;Máº¥t tÃ­ch&quot; Context trong @Async</h2>
<h3>ğŸ“– LÃ½ thuyáº¿t chuyÃªn sÃ¢u</h3>
<p>ThÃ´ng tin ngÆ°á»i dÃ¹ng (<code>SecurityContext</code>) hoáº·c dá»¯ liá»‡u Request (<code>RequestContext</code>) Ä‘Æ°á»£c Spring lÆ°u trá»¯ trong <strong>ThreadLocal</strong>. <code>@Async</code> sáº½ Ä‘áº©y tÃ¡c vá»¥ sang má»™t Thread má»›i tá»« Thread Pool. VÃ¬ <code>ThreadLocal</code> máº·c Ä‘á»‹nh khÃ´ng tá»± sao chÃ©p sang Thread con, nÃªn Thread má»›i sáº½ tháº¥y cÃ¡c Context nÃ y lÃ  <code>null</code>.</p>
<h3>âŒ Code lá»—i</h3>
<pre><code class="language-java">@Async
public void sendAuditLog() {
    // Tráº£ vá» null hoáº·c AnonymousUser vÃ¬ cháº¡y á»Ÿ Thread khÃ¡c
    String user = SecurityContextHolder.getContext().getAuthentication().getName(); 
}
</code></pre>
<h3>âœ… CÃ¡ch fix</h3>
<p>DÃ¹ng <code>DelegatingSecurityContextAsyncTaskExecutor</code> Ä‘á»ƒ copy Context hoáº·c truyá»n dá»¯ liá»‡u trá»±c tiáº¿p vÃ o tham sá»‘ hÃ m.</p>
<hr>
<h2>4. LazyInitializationException (NgoÃ i ranh giá»›i Transaction)</h2>
<h3>ğŸ“– LÃ½ thuyáº¿t chuyÃªn sÃ¢u</h3>
<p>Hibernate sá»­ dá»¥ng cÆ¡ cháº¿ <strong>Lazy Loading</strong> (chá»‰ táº£i dá»¯ liá»‡u khi cáº§n). Viá»‡c nÃ y yÃªu cáº§u má»™t Hibernate Session (káº¿t ná»‘i) cÃ²n má»Ÿ. ThÃ´ng thÆ°á»ng, Session nÃ y gáº¯n liá»n vá»›i Transaction á»Ÿ táº§ng Service. Khi method Service káº¿t thÃºc, Transaction Ä‘Ã³ng, Session Ä‘Ã³ng. Náº¿u táº§ng Controller hoáº·c View (Jackson) cá»‘ truy cáº­p field Lazy, lá»—i sáº½ xáº£y ra.</p>
<h3>âŒ Code lá»—i</h3>
<pre><code class="language-java">// Controller
User user = userService.findById(id); 
return user; // Jackson gá»i user.getRoles() -&gt; Session Ä‘Ã£ Ä‘Ã³ng -&gt; Exception!
</code></pre>
<h3>âœ… CÃ¡ch fix</h3>
<p>Sá»­ dá»¥ng <strong>Entity Graph</strong> hoáº·c <strong>Join Fetch</strong> trong Repository Ä‘á»ƒ láº¥y dá»¯ liá»‡u ngay táº¡i táº§ng Service.</p>
<pre><code class="language-java">@Query(&quot;SELECT u FROM User u JOIN FETCH u.roles WHERE u.id = :id&quot;)
User findByIdWithRoles(Long id);
</code></pre>
<hr>
<h2>5. Cáº¡m báº«y Class/Method <code>final</code></h2>
<h3>ğŸ“– LÃ½ thuyáº¿t chuyÃªn sÃ¢u</h3>
<p>ThÆ° viá»‡n <strong>CGLIB</strong> (máº·c Ä‘á»‹nh trong Spring) táº¡o Proxy báº±ng cÃ¡ch táº¡o ra má»™t Class con káº¿ thá»«a Class cá»§a báº¡n. Trong Java, khÃ´ng thá»ƒ káº¿ thá»«a Class <code>final</code> hoáº·c ghi Ä‘Ã¨ (override) Method <code>final</code>. Do Ä‘Ã³, Spring khÃ´ng thá»ƒ chÃ¨n logic Proxy vÃ o.</p>
<h3>âŒ Code lá»—i</h3>
<pre><code class="language-java">@Service
public final class MyService { // Spring khÃ´ng thá»ƒ táº¡o Proxy cho Class nÃ y
    @Transactional
    public final void update() {} // Method nÃ y sáº½ khÃ´ng bao giá» cÃ³ Transaction
}
</code></pre>
<h3>âœ… CÃ¡ch fix</h3>
<p>Loáº¡i bá» tá»« khÃ³a <code>final</code> á»Ÿ nhá»¯ng nÆ¡i cáº§n dÃ¹ng Annotation cá»§a Spring.</p>
<hr>
<h2>6. @ManyToMany vÃ  Foreign Key &quot;Máº¥t tÃ­ch&quot;</h2>
<h3>ğŸ“– LÃ½ thuyáº¿t chuyÃªn sÃ¢u</h3>
<p>Trong quan há»‡ <code>@ManyToMany</code>, Hibernate yÃªu cáº§u báº¡n xÃ¡c Ä‘á»‹nh bÃªn nÃ o lÃ  &quot;chá»§&quot; (owner - khÃ´ng cÃ³ <code>mappedBy</code>) vÃ  bÃªn nÃ o lÃ  &quot;nghá»‹ch&quot;. Náº¿u báº¡n chá»‰ thÃªm Ä‘á»‘i tÆ°á»£ng vÃ o danh sÃ¡ch cá»§a bÃªn &quot;nghá»‹ch&quot;, Hibernate sáº½ khÃ´ng lÆ°u gÃ¬ vÃ o báº£ng trung gian.</p>
<h3>âŒ Code lá»—i</h3>
<pre><code class="language-java">// Giáº£ sá»­ Category lÃ  bÃªn nghá»‹ch (cÃ³ mappedBy)
product.getCategories().add(category); 
categoryRepo.save(category); // Báº£ng trung gian product_category khÃ´ng cÃ³ dá»¯ liá»‡u!
</code></pre>
<h3>âœ… CÃ¡ch fix</h3>
<p>LuÃ´n cáº­p nháº­t cáº£ hai Ä‘áº§u cá»§a quan há»‡ thÃ´ng qua Helper Method.</p>
<hr>
<h2>7. <code>@TransactionalEventListener</code> &amp; AFTER_COMMIT</h2>
<h3>ğŸ“– LÃ½ thuyáº¿t chuyÃªn sÃ¢u</h3>
<p>Khi sá»­ dá»¥ng pha <code>AFTER_COMMIT</code>, Listener chá»‰ cháº¡y khi DB Ä‘Ã£ thá»±c hiá»‡n lá»‡nh Commit xong. Táº¡i thá»i Ä‘iá»ƒm nÃ y, Transaction cÅ© Ä‘Ã£ káº¿t thÃºc vÃ  Connection thÆ°á»ng Ä‘Ã£ á»Ÿ tráº¡ng thÃ¡i Read-only hoáº·c Ä‘Ã£ Ä‘Ã³ng. Má»i lá»‡nh <code>save()</code> bÃ¬nh thÆ°á»ng sáº½ bá»‹ lá» Ä‘i.</p>
<h3>âŒ Code lá»—i</h3>
<pre><code class="language-java">@TransactionalEventListener(phase = TransactionPhase.AFTER_COMMIT)
public void onUserRegistered(UserEvent event) {
    logRepo.save(new Log(event.userId())); // KhÃ´ng bÃ¡o lá»—i nhÆ°ng DB khÃ´ng cÃ³ log má»›i
}
</code></pre>
<h3>âœ… CÃ¡ch fix</h3>
<p>Sá»­ dá»¥ng <code>Propagation.REQUIRES_NEW</code> Ä‘á»ƒ má»Ÿ má»™t Transaction hoÃ n toÃ n má»›i.</p>
<pre><code class="language-java">@Transactional(propagation = Propagation.REQUIRES_NEW)
public void onUserRegistered(...) { ... }
</code></pre>
<hr>
<h2>8. Lá»—i HashCode/Equals vá»›i Hibernate Entity</h2>
<h3>ğŸ“– LÃ½ thuyáº¿t chuyÃªn sÃ¢u</h3>
<p>Khi má»™t Entity Ä‘Æ°á»£c Ä‘Æ°a vÃ o <code>Set</code> (nhÆ° <code>HashSet</code>), vá»‹ trÃ­ cá»§a nÃ³ phá»¥ thuá»™c vÃ o <code>hashCode()</code>. Äá»‘i vá»›i Entity dÃ¹ng ID tá»± tÄƒng (Identity), ID sáº½ lÃ  <code>null</code> trÆ°á»›c khi save vÃ  cÃ³ giÃ¡ trá»‹ sau khi save. Äiá»u nÃ y lÃ m thay Ä‘á»•i <code>hashCode</code>, khiáº¿n <code>Set</code> khÃ´ng tÃ¬m tháº¥y Object Ä‘Ã³ ná»¯a dÃ¹ nÃ³ váº«n á»Ÿ Ä‘Ã³.</p>
<h3>âŒ Code lá»—i</h3>
<pre><code class="language-java">@EqualsAndHashCode(of = &quot;id&quot;) // ID thay Ä‘á»•i tá»« null -&gt; Long khiáº¿n HashCode thay Ä‘á»•i
public class Product { ... }
</code></pre>
<h3>âœ… CÃ¡ch fix</h3>
<p>DÃ¹ng má»™t <strong>Business Key</strong> (nhÆ° mÃ£ UUID cá»‘ Ä‘á»‹nh hoáº·c Email) hoáº·c so sÃ¡nh theo tham chiáº¿u náº¿u khÃ´ng cÃ³ Business Key.</p>
<hr>
<h2>9. Virtual Thread Pinning (Spring Boot 3.2+)</h2>
<h3>ğŸ“– LÃ½ thuyáº¿t chuyÃªn sÃ¢u</h3>
<p>Virtual Threads (Java 21) ráº¥t nháº¹, nhÆ°ng chÃºng sáº½ bá»‹ &quot;ghim&quot; (pinning) vÃ o Thread váº­t lÃ½ náº¿u gáº·p khá»‘i <code>synchronized</code>. Náº¿u khá»‘i nÃ y chá»©a cÃ¡c tÃ¡c vá»¥ I/O lÃ¢u, toÃ n bá»™ Thread váº­t lÃ½ bá»‹ cháº·n, lÃ m máº¥t Ä‘i lá»£i tháº¿ cá»§a Virtual Threads.</p>
<h3>âŒ Code lá»—i</h3>
<pre><code class="language-java">public synchronized void heavyIO() { // Pinning xáº£y ra á»Ÿ Ä‘Ã¢y
    // Thá»±c hiá»‡n gá»i API bÃªn ngoÃ i hoáº·c truy váº¥n DB
}
</code></pre>
<h3>âœ… CÃ¡ch fix</h3>
<p>Sá»­ dá»¥ng <code>ReentrantLock</code> thay cho <code>synchronized</code>.</p>
<hr>
<h2>10. Thá»© tá»± thá»±c thi Aspect (@Order)</h2>
<h3>ğŸ“– LÃ½ thuyáº¿t chuyÃªn sÃ¢u</h3>
<p>Spring quáº£n lÃ½ cÃ¡c Aspect theo má»™t chuá»—i (Interceptor Chain). Náº¿u báº¡n cÃ³ má»™t Aspect tÃ¹y chá»‰nh (vÃ­ dá»¥ Logging) vÃ  <code>@Transactional</code>, mÃ  Logging cháº¡y &quot;sÃ¢u&quot; hÆ¡n Transaction, nÃ³ cÃ³ thá»ƒ ghi nháº­n dá»¯ liá»‡u Ä‘Ã£ lÆ°u thÃ nh cÃ´ng ngay cáº£ khi Transaction sau Ä‘Ã³ bá»‹ Rollback.</p>
<h3>âœ… CÃ¡ch fix</h3>
<p>Sá»­ dá»¥ng Annotation <code>@Order</code> Ä‘á»ƒ xÃ¡c Ä‘á»‹nh thá»© tá»±. Sá»‘ nhá» hÆ¡n sáº½ cháº¡y &quot;vÃ²ng ngoÃ i&quot; (Ä‘Æ°á»£c thá»±c thi trÆ°á»›c vÃ  káº¿t thÃºc sau).</p>
<hr>
<h2>11. Thá»© tá»± Load Bean vá»›i @ConditionalOnMissingBean</h2>
<h3>ğŸ“– LÃ½ thuyáº¿t chuyÃªn sÃ¢u</h3>
<p>Trong Spring Boot, cÃ¡c Bean Ä‘Æ°á»£c load theo thá»© tá»± quÃ©t Component. Náº¿u Bean cá»§a báº¡n Ä‘Æ°á»£c khá»Ÿi táº¡o <strong>sau</strong> Bean cá»§a má»™t thÆ° viá»‡n nÃ o Ä‘Ã³ cÃ³ dÃ¹ng <code>@ConditionalOnMissingBean</code>, thÃ¬ Ä‘iá»u kiá»‡n cá»§a thÆ° viá»‡n Ä‘Ã£ Ä‘Æ°á»£c check xong vÃ  Bean cá»§a báº¡n khÃ´ng thá»ƒ ghi Ä‘Ã¨ (override) Ä‘Æ°á»£c ná»¯a.</p>
<h3>âœ… CÃ¡ch fix</h3>
<p>Sá»­ dá»¥ng <code>@AutoConfigureBefore</code> hoáº·c <code>@AutoConfigureAfter</code> trong cÃ¡c lá»›p <code>@Configuration</code> Ä‘á»ƒ chá»‰ Ä‘á»‹nh thá»© tá»± load Bean chÃ­nh xÃ¡c.</p>
<hr>
<h2>12. QuÃªn @StepScope trong Spring Batch</h2>
<h3>ğŸ“– LÃ½ thuyáº¿t chuyÃªn sÃ¢u</h3>
<p>Trong Spring Batch, cÃ¡c tham sá»‘ nhÆ° <code>jobParameters</code> khÃ´ng cÃ³ sáºµn khi á»©ng dá»¥ng khá»Ÿi Ä‘á»™ng. ChÃºng chá»‰ cÃ³ giÃ¡ trá»‹ khi má»™t Step báº¯t Ä‘áº§u cháº¡y. Náº¿u khÃ´ng cÃ³ <code>@StepScope</code>, Spring sáº½ cá»‘ gáº¯ng khá»Ÿi táº¡o Bean ngay láº­p tá»©c (Eagerly) vÃ  gÃ¢y lá»—i vÃ¬ thiáº¿u tham sá»‘.</p>
<h3>âŒ Code lá»—i</h3>
<pre><code class="language-java">@Bean
public ItemReader reader(@Value(&quot;#{jobParameters[&#39;input.file&#39;]}&quot;) String path) {
    return new FlatFileItemReader(path); // &#39;path&#39; luÃ´n lÃ  null khi khá»Ÿi Ä‘á»™ng
}
</code></pre>
<h3>âœ… CÃ¡ch fix</h3>
<p>ThÃªm <code>@StepScope</code> Ä‘á»ƒ trÃ¬ hoÃ£n viá»‡c táº¡o Bean cho Ä‘áº¿n khi Step thá»±c sá»± cháº¡y.</p>
<hr>
<h3>ğŸ’¡ Báº£ng tá»•ng káº¿t nhanh</h3>
<table>
<thead>
<tr>
<th>Lá»—i</th>
<th>NguyÃªn nhÃ¢n gá»‘c</th>
<th>Keyword tÃ¬m kiáº¿m</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Self-invocation</strong></td>
<td>Bá» qua AOP Proxy</td>
<td><code>Spring AOP internal call</code></td>
</tr>
<tr>
<td><strong>Checked Rollback</strong></td>
<td>Máº·c Ä‘á»‹nh chá»‰ báº¯t Runtime</td>
<td><code>Transactional rollbackFor</code></td>
</tr>
<tr>
<td><strong>Missing Context</strong></td>
<td>ThreadLocal khÃ´ng copy</td>
<td><code>SecurityContext Async</code></td>
</tr>
<tr>
<td><strong>Lazy Init</strong></td>
<td>Session Ä‘Ã£ Ä‘Ã³ng</td>
<td><code>FetchType.LAZY Proxy</code></td>
</tr>
<tr>
<td><strong>No Save (After Commit)</strong></td>
<td>Transaction Ä‘Ã£ hoÃ n táº¥t</td>
<td><code>TransactionalEventListener REQUIRES_NEW</code></td>
</tr>
<tr>
<td><strong>Virtual Thread Slow</strong></td>
<td>Thread Pinning</td>
<td><code>Virtual Thread synchronized</code></td>
</tr>
</tbody></table>
<hr>

          </article>

          <!-- Navigation Footer (Next/Prev) -->
          <div class="mt-12 pt-8 border-t border-gray-200 flex justify-between">
            <a href="topic08.html" class="text-indigo-600 font-medium hover:text-indigo-800">â† ğŸ“˜ Cáº©m Nang ToÃ n Táº­p: JPA Relationships & Migration (2026 Edition)</a>
          </div>
        </div>
      </main>
    </div>

    <!-- Overlay for mobile sidebar -->
    <div
      onclick="toggleSidebar()"
      id="overlay"
      class="fixed inset-0 bg-black/50 z-10 lg:hidden hidden"
      style="display: none"
    ></div>
    <script>
      // Simple overlay logic
      const sidebar = document.getElementById("sidebar");
      const overlay = document.getElementById("overlay");

      // Sync overlay with sidebar state check if needed, but for "simplest" just toggle visibility in CSS or JS.
      // Actually, let's keep it simple.
    </script>
  </body>
</html>
