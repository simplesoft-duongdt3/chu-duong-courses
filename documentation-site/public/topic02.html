<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ch·ªß ƒë·ªÅ 2: IoC Container & Dependency Injection (DI)</title>
    <!-- Tailwind CSS via CDN for simplicity and reliability -->
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom Scrollbar for Sidebar */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        html {
            scroll-behavior: smooth;
        }
    </style>
    <script>
      function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        sidebar.classList.toggle("-translate-x-full");
      }
    </script>
  </head>
  <body class="bg-slate-50 text-slate-900 antialiased flex flex-col min-h-screen">
    <!-- Header -->
    <header class="bg-white border-b border-gray-200 sticky top-0 z-30">
      <div
        class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between"
      >
        <div class="flex items-center">
          <button
            onclick="toggleSidebar()"
            class="lg:hidden p-2 rounded-md text-gray-600 hover:bg-gray-100"
          >
            <svg
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16"
              />
            </svg>
          </button>
          <a
            href="index.html"
            class="ml-3 lg:ml-0 text-xl font-bold text-gray-900 tracking-tight"
          >
            <span class="text-indigo-600">Spring Boot</span> for Frontend Devs
          </a>
        </div>
        <!-- Optional Top Links -->
        <div class="hidden md:flex space-x-4">
          <a
            href="https://github.com/simplesoft-duongdt3/chu-duong-courses"
            target="_blank"
            class="text-gray-500 hover:text-gray-900 transition font-medium"
            >GitHub</a
          >
        </div>
      </div>
    </header>

    <div class="flex-1 max-w-7xl w-full mx-auto flex items-start">
      <!-- Sidebar Navigation -->
      <!-- Sidebar Navigation -->
      <aside
        id="sidebar"
        class="fixed inset-0 z-50 bg-white transform -translate-x-full transition-transform duration-300 ease-in-out lg:translate-x-0 lg:static lg:z-0 lg:w-64 lg:h-[calc(100vh-4rem)] lg:bg-transparent lg:border-r lg:border-gray-200 lg:sticky lg:top-16 overflow-y-auto"
      >
        <div class="p-4 flex justify-between items-center lg:hidden border-b border-gray-100 mb-2">
            <span class="font-bold text-gray-900">Menu</span>
            <button onclick="toggleSidebar()" class="p-2 -mr-2 text-gray-500 hover:text-gray-700">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
        <nav class="p-4 space-y-1">
          <div class="mb-4">
            <p
              class="px-2 text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2"
            >
              Ch∆∞∆°ng tr√¨nh h·ªçc
            </p>
            <a href="index.html" class="block px-2 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 group flex items-center">
            Spring Boot for Frontend Devs
        </a>
<a href="topic01.html" class="block px-2 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 group flex items-center">
            Ch·ªß ƒë·ªÅ 1: Request-Response Cycle & The Middleware Chain
        </a>
<a href="topic02.html" class="block px-2 py-2 text-sm font-medium text-indigo-600 bg-indigo-50 rounded-md hover:bg-gray-100 group flex items-center">
            Ch·ªß ƒë·ªÅ 2: IoC Container & Dependency Injection (DI)
        </a>
<a href="topic03.html" class="block px-2 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 group flex items-center">
            Ch·ªß ƒë·ªÅ 3: Persistence v·ªõi Spring Data JPA & Hibernate
        </a>
<a href="topic04.html" class="block px-2 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 group flex items-center">
            Ch·ªß ƒë·ªÅ 4: Transaction Management - Qu·∫£n l√Ω giao d·ªãch
        </a>
<a href="topic05.html" class="block px-2 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 group flex items-center">
            Ch·ªß ƒë·ªÅ 5: Validation & Global Exception Handling
        </a>
<a href="topic06.html" class="block px-2 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 group flex items-center">
            Ch·ªß ƒë·ªÅ 6: Spring Security & JWT (Stateless Authentication)
        </a>
<a href="topic07.html" class="block px-2 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 group flex items-center">
            Ch·ªß ƒë·ªÅ 7: Logging & Monitoring (Actuator)
        </a>
<a href="topic08.html" class="block px-2 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 group flex items-center">
            üìò C·∫©m Nang To√†n T·∫≠p: JPA Relationships & Migration (2026 Edition)
        </a>
<a href="topic_black_holes.html" class="block px-2 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 group flex items-center">
            üõ°Ô∏è Spring Boot 3 Survival Guide: 12 "Black Holes" & Deep Debugging
        </a>
          </div>
        </nav>
      </aside>

      <!-- Main Content -->
      <main class="flex-1 min-w-0 p-4 sm:p-6 lg:padding-8">
        <div class="max-w-4xl mx-auto">
          <article
            class="prose prose-slate prose-lg max-w-none prose-headings:font-bold prose-a:text-indigo-600 hover:prose-a:text-indigo-500 prose-img:rounded-xl shadow-none"
          >
            <p>Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi &quot;linh h·ªìn&quot; c·ªßa Spring Framework. N·∫øu ·ªü Frontend, b·∫°n th∆∞·ªùng xuy√™n d√πng <code>import</code> ho·∫∑c <code>require</code> ƒë·ªÉ s·ª≠ d·ª•ng m·ªôt module, th√¨ ·ªü Spring Boot, vi·ªác kh·ªüi t·∫°o v√† qu·∫£n l√Ω ƒë·ªëi t∆∞·ª£ng (Object) l·∫°i do h·ªá th·ªëng ƒë·∫£m nh·∫≠n.</p>
<hr>
<h1>Ch·ªß ƒë·ªÅ 2: IoC Container &amp; Dependency Injection (DI)</h1>
<h3>1. L√Ω thuy·∫øt: &quot;ƒê·ª´ng g·ªçi cho ch√∫ng t√¥i, ch√∫ng t√¥i s·∫Ω g·ªçi cho b·∫°n&quot;</h3>
<h4><strong>Inversion of Control (IoC) - ƒê·∫£o ng∆∞·ª£c quy·ªÅn ƒëi·ªÅu khi·ªÉn</strong></h4>
<p>Trong l·∫≠p tr√¨nh truy·ªÅn th·ªëng, n·∫øu l·ªõp <code>A</code> c·∫ßn l·ªõp <code>B</code>, b·∫°n s·∫Ω vi·∫øt: <code>B objB = new B()</code>. T·ª©c l√† b·∫°n (ng∆∞·ªùi code) n·∫Øm quy·ªÅn ƒëi·ªÅu khi·ªÉn vi·ªác t·∫°o ƒë·ªëi t∆∞·ª£ng.<br>Trong Spring, b·∫°n ch·ªâ c·∫ßn khai b√°o: &quot;T√¥i c·∫ßn m·ªôt ƒë·ªëi t∆∞·ª£ng ki·ªÉu <code>B</code>&quot;. Spring s·∫Ω t·ª± t√¨m, t·ª± t·∫°o v√† ƒë∆∞a n√≥ cho b·∫°n. Quy·ªÅn ƒëi·ªÅu khi·ªÉn ƒë√£ b·ªã &quot;ƒë·∫£o ng∆∞·ª£c&quot; t·ª´ tay b·∫°n sang tay Framework (IoC Container).</p>
<h4><strong>Dependency Injection (DI) - Ti√™m ph·ª• thu·ªôc</strong></h4>
<p>DI l√† c√°ch th·ª©c c·ª• th·ªÉ ƒë·ªÉ th·ª±c hi·ªán IoC. Spring s·∫Ω &quot;ti√™m&quot; (inject) c√°c ph·ª• thu·ªôc v√†o m·ªôt class th√¥ng qua:</p>
<ol>
<li><strong>Constructor Injection</strong> (Khuy√™n d√πng).</li>
<li><strong>Setter Injection</strong>.</li>
<li><strong>Field Injection</strong> (D√πng <code>@Autowired</code> tr·ª±c ti·∫øp l√™n bi·∫øn - kh√¥ng khuy·∫øn kh√≠ch cho logic ph·ª©c t·∫°p).</li>
</ol>
<h4><strong>Spring Bean l√† g√¨?</strong></h4>
<p>M·ªôt c√°i t√™n nghe r·∫•t k√™u cho m·ªôt kh√°i ni·ªám ƒë∆°n gi·∫£n: <strong>Bean l√† m·ªôt Object ƒë∆∞·ª£c qu·∫£n l√Ω b·ªüi Spring IoC Container</strong>. N·∫øu b·∫°n t·ª± <code>new</code>, ƒë√≥ l√† Object th∆∞·ªùng. N·∫øu Spring <code>new</code> cho b·∫°n, ƒë√≥ l√† Bean.</p>
<hr>
<h3>2. V√≠ d·ª• Code &amp; C·∫•u h√¨nh</h3>
<h4><strong>A. C√°ch ƒë·ªãnh nghƒ©a m·ªôt Bean</strong></h4>
<p>S·ª≠ d·ª•ng c√°c Stereotype Annotations ƒë·ªÉ ƒë√°nh d·∫•u class l√† m·ªôt Bean.</p>
<pre><code class="language-java">@Service // ƒê√°nh d·∫•u ƒë√¢y l√† m·ªôt Bean t·∫ßng nghi·ªáp v·ª•
public class EmailService {
    public void sendEmail(String message) {
        System.out.println(&quot;Sending email: &quot; + message);
    }
}
</code></pre>
<h4><strong>B. C√°ch &quot;Ti√™m&quot; (Inject) Bean - Constructor Injection</strong></h4>
<p>ƒê√¢y l√† c√°ch t·ªët nh·∫•t v√¨ n√≥ gi√∫p code d·ªÖ Unit Test v√† ƒë·∫£m b·∫£o t√≠nh b·∫•t bi·∫øn (Immutable).</p>
<pre><code class="language-java">@RestController
@RequestMapping(&quot;/api/notifications&quot;)
public class NotificationController {

    private final EmailService emailService;

    // Spring s·∫Ω t·ª± ƒë·ªông t√¨m Bean EmailService v√† truy·ªÅn v√†o ƒë√¢y
    // T·ª´ Spring 4.3+, n·∫øu ch·ªâ c√≥ 1 constructor, kh√¥ng c·∫ßn g·∫Øn @Autowired
    public NotificationController(EmailService emailService) {
        this.emailService = emailService;
    }

    @PostMapping(&quot;/send&quot;)
    public String notifyUser() {
        emailService.sendEmail(&quot;Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi Spring Boot 3!&quot;);
        return &quot;Sent!&quot;;
    }
}
</code></pre>
<h4>**C. C·∫•u h√¨nh Bean th·ªß c√¥ng b·∫±ng <code>@Bean**</code></h4>
<p>D√πng khi b·∫°n mu·ªën kh·ªüi t·∫°o Object t·ª´ th∆∞ vi·ªán b√™n th·ª© 3 (v√≠ d·ª•: ModelMapper, Jedis, v.v.) m√† b·∫°n kh√¥ng th·ªÉ s·ª≠a code ngu·ªìn c·ªßa h·ªç ƒë·ªÉ th√™m <code>@Service</code>.</p>
<pre><code class="language-java">@Configuration
public class AppConfig {

    @Bean
    public RestTemplate restTemplate() {
        // T·ª± c·∫•u h√¨nh m·ªôt l·∫ßn, d√πng ·ªü m·ªçi n∆°i trong App
        return new RestTemplate();
    }
}
</code></pre>
<hr>
<h3>3. T√¨nh hu·ªëng th·ª±c t·∫ø (Real-world Scenarios)</h3>
<p><strong>T√¨nh hu·ªëng 1: Loose Coupling - Thay ƒë·ªïi tri·ªÉn khai m√† kh√¥ng s·ª≠a code</strong></p>
<ul>
<li><strong>V·∫•n ƒë·ªÅ:</strong> B·∫°n c√≥ giao di·ªán <code>PaymentStorage</code>. Hi·ªán t·∫°i b·∫°n ƒëang l∆∞u v√†o <code>MySQL</code>. Sau n√†y s·∫øp mu·ªën chuy·ªÉn sang <code>S3</code>.</li>
<li><strong>Gi·∫£i ph√°p:</strong> 1. T·∫°o Interface <code>StorageService</code>.</li>
</ul>
<ol start="2">
<li>T·∫°o 2 class tri·ªÉn khai: <code>MysqlStorage</code> v√† <code>S3Storage</code> ƒë·ªÅu ƒë√°nh d·∫•u l√† Bean.</li>
<li>Khi c·∫ßn ƒë·ªïi, b·∫°n ch·ªâ c·∫ßn thay ƒë·ªïi Annotation <code>@Primary</code> ho·∫∑c d√πng <code>@Qualifier</code> ƒë·ªÉ ch·ªçn c√°i mu·ªën d√πng. Code ·ªü Controller/Service s·ª≠ d·ª•ng Interface n√™n <strong>kh√¥ng ph·∫£i thay ƒë·ªïi m·ªôt d√≤ng n√†o</strong>.</li>
</ol>
<p><strong>T√¨nh hu·ªëng 2: Qu·∫£n l√Ω Singleton (T·ªëi ∆∞u b·ªô nh·ªõ)</strong></p>
<ul>
<li><strong>V·∫•n ƒë·ªÅ:</strong> B·∫°n c√≥ m·ªôt class <code>ConfigurationManager</code> chuy√™n ƒë·ªçc file config n·∫∑ng. N·∫øu m·ªói request b·∫°n l·∫°i <code>new</code> n√≥ m·ªôt l·∫ßn, server s·∫Ω s·ªõm h·∫øt RAM.</li>
<li><strong>Gi·∫£i ph√°p:</strong> M·∫∑c ƒë·ªãnh m·ªçi Bean trong Spring l√† <strong>Singleton</strong>. Spring ch·ªâ t·∫°o ƒë√∫ng m·ªôt instance duy nh·∫•t c·ªßa <code>ConfigurationManager</code> v√† d√πng chung cho to√†n b·ªô ·ª©ng d·ª•ng. Dev Frontend s·∫Ω th·∫•y n√≥ gi·ªëng nh∆∞ m·ªôt <code>Global State</code> nh∆∞ng an to√†n h∆°n.</li>
</ul>
<p><strong>T√¨nh hu·ªëng 3: Circular Dependency (L·ªói v√≤ng l·∫∑p)</strong></p>
<ul>
<li><strong>V·∫•n ƒë·ªÅ:</strong> Class <code>A</code> c·∫ßn class <code>B</code> trong constructor, v√† class <code>B</code> c≈©ng l·∫°i c·∫ßn class <code>A</code>.</li>
<li><strong>Gi·∫£i ph√°p:</strong> Spring Boot 3 s·∫Ω b√°o l·ªói ngay khi kh·ªüi ƒë·ªông ƒë·ªÉ b·∫£o v·ªá b·∫°n. ƒêi·ªÅu n√†y √©p bu·ªôc b·∫°n ph·∫£i thi·∫øt k·∫ø l·∫°i ki·∫øn tr√∫c (v√≠ d·ª•: t√°ch logic chung ra class <code>C</code>), gi√∫p code Backend lu√¥n m·∫°ch l·∫°c, tr√°nh s·ª± ch·ªìng ch√©o &quot;spaghetti&quot; th∆∞·ªùng th·∫•y khi dev frontend l·∫°m d·ª•ng import v√≤ng quanh.</li>
</ul>
<hr>
<h3>T√≥m t·∫Øt so s√°nh cho Dev Frontend</h3>
<table>
<thead>
<tr>
<th>Kh√°i ni·ªám</th>
<th>Frontend (JS/TS)</th>
<th>Backend (Spring Boot)</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Kh·ªüi t·∫°o</strong></td>
<td><code>import { S } from &#39;./S&#39;; const s = new S();</code></td>
<td><code>@Autowired</code> ho·∫∑c Constructor Injection</td>
</tr>
<tr>
<td><strong>Qu·∫£n l√Ω</strong></td>
<td>Dev t·ª± qu·∫£n l√Ω v√≤ng ƒë·ªùi</td>
<td>Spring IoC Container qu·∫£n l√Ω</td>
</tr>
<tr>
<td><strong>Ph·∫°m vi (Scope)</strong></td>
<td>Th∆∞·ªùng l√† module-based</td>
<td>M·∫∑c ƒë·ªãnh l√† Singleton (to√†n App)</td>
</tr>
<tr>
<td><strong>R√†ng bu·ªôc</strong></td>
<td>Kh√≥ ki·ªÉm so√°t ph·ª• thu·ªôc ch√©o</td>
<td>Ph√°t hi·ªán l·ªói ph·ª• thu·ªôc ngay khi start app</td>
</tr>
</tbody></table>
<hr>
<p>Vi·ªác ch·ªâ d√πng <code>@Service</code> hay <code>@Component</code> l√† qu√° ƒë∆°n gi·∫£n. Trong c√°c d·ª± √°n th·ª±c t·∫ø, vi·ªác c·∫•u h√¨nh Bean th·ªß c√¥ng b·∫±ng <code>@Bean</code> ch√≠nh l√† n∆°i th·ªÉ hi·ªán tr√¨nh ƒë·ªô thi·∫øt k·∫ø h·ªá th·ªëng.</p>
<hr>
<h1>Ch·ªß ƒë·ªÅ 2.1: N√¢ng cao v·ªÅ @Bean v√† B√≠ m·∫≠t c·ªßa Singleton Scope</h1>
<h3>1. L√Ω thuy·∫øt: T·∫°i sao l·∫°i l√† Singleton?</h3>
<p>Trong th·∫ø gi·ªõi Spring, m·∫∑c ƒë·ªãnh m·ªçi Bean l√† <strong>Singleton</strong>. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† Spring IoC Container ch·ªâ t·∫°o ra <strong>duy nh·∫•t m·ªôt th·ª±c th·ªÉ (instance)</strong> c·ªßa Bean ƒë√≥ cho to√†n b·ªô v√≤ng ƒë·ªùi c·ªßa ·ª©ng d·ª•ng.</p>
<p><strong>T·∫°i sao Spring l·∫°i ch·ªçn nh∆∞ v·∫≠y?</strong></p>
<ol>
<li><strong>Ti·∫øt ki·ªám t√†i nguy√™n (Memory &amp; CPU):</strong> Vi·ªác kh·ªüi t·∫°o m·ªôt Object trong Java k√®m theo vi·ªác &quot;ti√™m&quot; h√†ng ch·ª•c ph·ª• thu·ªôc kh√°c v√†o n√≥ t·ªën chi ph√≠. Thay v√¨ t·∫°o m·ªõi cho m·ªói Request (nh∆∞ c√°ch JavaScript th∆∞·ªùng l√†m v·ªõi c√°c bi·∫øn c·ª•c b·ªô), Spring d√πng l·∫°i m·ªôt instance duy nh·∫•t.</li>
<li><strong>Hi·ªáu nƒÉng Garbage Collection (GC):</strong> √çt object ƒë∆∞·ª£c t·∫°o ra v√† h·ªßy ƒëi ƒë·ªìng nghƒ©a v·ªõi vi·ªác b·ªô d·ªçn r√°c (GC) c·ªßa Java l√†m vi·ªác √≠t h∆°n, gi√∫p ·ª©ng d·ª•ng ch·∫°y m∆∞·ª£t m√†, tr√°nh t√¨nh tr·∫°ng &quot;Stop the world&quot;.</li>
<li><strong>Stateless Services:</strong> ƒêa s·ªë c√°c Service trong Backend l√† &quot;kh√¥ng tr·∫°ng th√°i&quot; (stateless). N√≥ gi·ªëng nh∆∞ m·ªôt c√°i m√°y xay sinh t·ªë: n√≥ ch·ªâ c√≥ logic (xay), kh√¥ng l∆∞u tr·ªØ tr√°i c√¢y c≈© b√™n trong. Do ƒë√≥, c·∫£ ngh√¨n ng∆∞·ªùi d√πng chung m·ªôt &quot;m√°y xay&quot; l√† ho√†n to√†n kh·∫£ thi.</li>
</ol>
<blockquote>
<p><strong>C·∫£nh b√°o cho Frontend Dev:</strong> N·∫øu b·∫°n khai b√°o m·ªôt bi·∫øn <code>private int count = 0;</code> trong m·ªôt <code>@Service</code> v√† tƒÉng n√≥ m·ªói khi c√≥ API g·ªçi v√†o, th√¨ <strong>t·∫•t c·∫£ ng∆∞·ªùi d√πng</strong> s·∫Ω c√πng tƒÉng c√°i bi·∫øn ƒë√≥. ƒê√¢y l√† l·ªói b·∫£o m·∫≠t v√† logic c·ª±c k·ª≥ nghi√™m tr·ªçng.</p>
</blockquote>
<hr>
<h3>2. V√≠ d·ª• Code: C√°c tr∆∞·ªùng h·ª£p @Bean ph·ª©c t·∫°p</h3>
<h4>A. Bean c√≥ ƒëi·ªÅu ki·ªán (@Conditional)</h4>
<p>Gi·∫£ s·ª≠ b·∫°n mu·ªën d√πng Memcached khi ·ªü m√¥i tr∆∞·ªùng th·∫≠t, nh∆∞ng d√πng Map (t·∫°m th·ªùi) khi ch·∫°y m√°y local ƒë·ªÉ ƒë·ª° ph·∫£i c√†i ƒë·∫∑t.</p>
<pre><code class="language-java">@Configuration
public class CacheConfig {

    @Bean
    @ConditionalOnProperty(name = &quot;app.cache.type&quot;, havingValue = &quot;redis&quot;)
    public CacheService redisCacheService() {
        return new RedisCacheService(); // Ch·ªâ kh·ªüi t·∫°o n·∫øu config l√† redis
    }

    @Bean
    @ConditionalOnMissingBean(CacheService.class)
    public CacheService localCacheService() {
        return new LocalMapCacheService(); // Kh·ªüi t·∫°o n·∫øu kh√¥ng c√≥ th·∫±ng n√†o ·ªü tr√™n kh·ªõp
    }
}
</code></pre>
<h4>B. N·∫°p c·∫•u h√¨nh t·ª´ b√™n ngo√†i v√†o Bean</h4>
<p>B·∫°n kh√¥ng n√™n hardcode th√¥ng s·ªë. H√£y ƒë·ªÉ <code>@Bean</code> ƒë·ªçc t·ª´ file <code>.yml</code> ho·∫∑c <code>.properties</code>.</p>
<pre><code class="language-java">@Configuration
public class ThirdPartyConfig {

    @Value(&quot;${stripe.api.key}&quot;)
    private String apiKey;

    @Bean
    public StripeClient stripeClient() {
        // Kh·ªüi t·∫°o th∆∞ vi·ªán b√™n th·ª© 3 v·ªõi th√¥ng s·ªë t·ª´ config
        return new StripeClient(apiKey);
    }
}
</code></pre>
<hr>
<h3>3. T√¨nh hu·ªëng th·ª±c t·∫ø (Real-world Scenarios)</h3>
<p><strong>T√¨nh hu·ªëng 1: T√≠ch h·ª£p SDK c·ªßa b√™n th·ª© 3 (V√≠ d·ª•: Firebase/S3)</strong></p>
<ul>
<li><strong>V·∫•n ƒë·ªÅ:</strong> SDK c·ªßa Firebase y√™u c·∫ßu b·∫°n ph·∫£i n·∫°p file <code>serviceAccountKey.json</code> v√† kh·ªüi t·∫°o m·ªôt l·∫ßn duy nh·∫•t. B·∫°n kh√¥ng th·ªÉ s·ª≠a code c·ªßa Google ƒë·ªÉ th√™m <code>@Service</code>.</li>
<li><strong>Gi·∫£i ph√°p:</strong> Vi·∫øt m·ªôt class <code>@Configuration</code>, d√πng <code>@Bean</code> ƒë·ªÉ ƒë·ªçc file JSON, kh·ªüi t·∫°o <code>FirebaseApp</code>. Sau ƒë√≥, ·ªü b·∫•t k·ª≥ ƒë√¢u trong d·ª± √°n, b·∫°n ch·ªâ c·∫ßn <code>@Autowired</code> c√°i <code>FirebaseApp</code> ƒë√≥ ƒë·ªÉ d√πng.</li>
</ul>
<p><strong>T√¨nh hu·ªëng 2: Gi·∫£i quy·∫øt b√†i to√°n &quot;ƒêa chi nh√°nh&quot; (Multi-tenancy)</strong></p>
<ul>
<li><strong>V·∫•n ƒë·ªÅ:</strong> H·ªá th·ªëng c·ªßa b·∫°n ph·ª•c v·ª• nhi·ªÅu c√¥ng ty. M·ªói c√¥ng ty c√≥ m·ªôt Database kh√°c nhau.</li>
<li><strong>Gi·∫£i ph√°p:</strong> B·∫°n kh√¥ng th·ªÉ ƒë·ªãnh nghƒ©a c·ª©ng m·ªôt Bean <code>DataSource</code>. B·∫°n c·∫ßn d√πng <code>@Bean</code> k·∫øt h·ª£p v·ªõi <code>AbstractRoutingDataSource</code>. Spring s·∫Ω d·ª±a v√†o m√£ c√¥ng ty trong Request ƒë·ªÉ &quot;nh·∫•c&quot; ƒë√∫ng Bean Database t∆∞∆°ng ·ª©ng ra x·ª≠ l√Ω.</li>
</ul>
<p><strong>T√¨nh hu·ªëng 3: Prototype Scope - Khi b·∫°n C·∫¶N tr·∫°ng th√°i ri√™ng</strong></p>
<ul>
<li><strong>V·∫•n ƒë·ªÅ:</strong> B·∫°n vi·∫øt m·ªôt logic x·ª≠ l√Ω file Excel c·ª±c l·ªõn, c·∫ßn l∆∞u tr·ªØ tr·∫°ng th√°i h√†ng ƒëang ƒë·ªçc ƒë·ªÉ b√°o c√°o ti·∫øn ƒë·ªô (Percent complete) ri√™ng cho m·ªói ng∆∞·ªùi d√πng.</li>
<li><strong>Gi·∫£i ph√°p:</strong> L√∫c n√†y Singleton s·∫Ω l√†m h·ªèng d·ªØ li·ªáu c·ªßa nhau. B·∫°n ph·∫£i khai b√°o <code>@Bean</code> v·ªõi <code>@Scope(&quot;prototype&quot;)</code>. M·ªói l·∫ßn b·∫°n g·ªçi <code>getBean()</code>, Spring s·∫Ω t·∫°o ra m·ªôt instance <strong>m·ªõi tinh</strong>.</li>
</ul>
<hr>
<h3>B·∫£ng so s√°nh Scopes ph·ªï bi·∫øn</h3>
<table>
<thead>
<tr>
<th>Scope</th>
<th>ƒê·∫∑c ƒëi·ªÉm</th>
<th>Ph√π h·ª£p cho</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Singleton</strong> (M·∫∑c ƒë·ªãnh)</td>
<td>1 instance cho c·∫£ App</td>
<td>Service, Repository, Controller</td>
</tr>
<tr>
<td><strong>Prototype</strong></td>
<td>M·ªói l·∫ßn inject l√† 1 instance m·ªõi</td>
<td>Object ch·ª©a d·ªØ li·ªáu t·∫°m th·ªùi (Stateful)</td>
</tr>
<tr>
<td><strong>Request</strong></td>
<td>1 instance cho m·ªói HTTP request</td>
<td>L∆∞u th√¥ng tin User, Log cho t·ª´ng request</td>
</tr>
<tr>
<td><strong>Session</strong></td>
<td>1 instance cho m·ªói phi√™n ƒëƒÉng nh·∫≠p</td>
<td>Gi·ªè h√†ng (Shopping Cart)</td>
</tr>
</tbody></table>
<hr>
<h3>T√≥m t·∫Øt cho &quot;D√¢n App/Frontend&quot;</h3>
<p>H√£y t∆∞·ªüng t∆∞·ª£ng <strong>Singleton</strong> gi·ªëng nh∆∞ m·ªôt c√°i <strong>Global Store</strong> nh∆∞ng ch·ªâ ch·ª©a c√°c <strong>H√†m (Functions)</strong>. B·∫°n kh√¥ng bao gi·ªù l∆∞u d·ªØ li·ªáu c·ªßa user v√†o ƒë√≥. N·∫øu mu·ªën l∆∞u d·ªØ li·ªáu t·∫°m th·ªùi cho t·ª´ng user, h√£y d√πng Database ho·∫∑c Redis.</p>
<hr>
<p>Vi·ªác hi·ªÉu r√µ <strong>Bean Scope</strong> l√† b∆∞·ªõc ngo·∫∑t gi√∫p b·∫°n ki·ªÉm so√°t ƒë∆∞·ª£c b·ªô nh·ªõ v√† tr√°nh nh·ªØng l·ªói &quot;data leak&quot; (d·ªØ li·ªáu ng∆∞·ªùi n√†y l·∫´n sang ng∆∞·ªùi kia) c·ª±c k·ª≥ nguy hi·ªÉm trong Backend.</p>
<p>D∆∞·ªõi ƒë√¢y l√† n·ªôi dung chi ti·∫øt cho ph·∫ßn Bean Scopes.</p>
<hr>
<h1>Ch·ªß ƒë·ªÅ 2.2: Chi ti·∫øt v·ªÅ Bean Scopes - Khi n√†o t·∫°o m·ªõi, khi n√†o d√πng chung?</h1>
<p>Trong Spring Boot 3, vi·ªác ch·ªçn Scope quy·∫øt ƒë·ªãnh <strong>v√≤ng ƒë·ªùi</strong> v√† <strong>ph·∫°m vi chia s·∫ª</strong> c·ªßa m·ªôt ƒë·ªëi t∆∞·ª£ng.</p>
<h3>1. L√Ω thuy·∫øt: 4 lo·∫°i Scope ph·ªï bi·∫øn nh·∫•t</h3>
<ol>
<li><strong>Singleton (M·∫∑c ƒë·ªãnh):</strong> Spring IoC container t·∫°o ƒë√∫ng 1 instance duy nh·∫•t. M·ªçi ch·ªó <code>@Autowired</code> ƒë·ªÅu d√πng chung instance n√†y.</li>
<li><strong>Prototype:</strong> M·ªói l·∫ßn <code>@Autowired</code> ho·∫∑c g·ªçi <code>getBean()</code>, Spring s·∫Ω t·∫°o ra 1 instance <strong>m·ªõi ho√†n to√†n</strong>.</li>
<li><strong>Request Scope:</strong> M·ªói HTTP Request ƒë·∫øn s·∫Ω c√≥ 1 instance ri√™ng. Request k·∫øt th√∫c, Bean b·ªã h·ªßy. (Ch·ªâ d√πng trong Web App).</li>
<li><strong>Session Scope:</strong> Instance t·ªìn t·∫°i xuy√™n su·ªët m·ªôt phi√™n l√†m vi·ªác c·ªßa ng∆∞·ªùi d√πng (t·ª´ l√∫c Login ƒë·∫øn l√∫c Logout/H·∫øt h·∫°n).</li>
</ol>
<hr>
<h3>2. V√≠ d·ª• Code &amp; C·∫•u h√¨nh</h3>
<h4>A. Singleton &amp; Prototype (C∆° b·∫£n)</h4>
<pre><code class="language-java">@Component
@Scope(&quot;singleton&quot;) // C√≥ th·ªÉ b·ªè qua v√¨ l√† m·∫∑c ƒë·ªãnh
public class StatisticsService {
    // D√πng chung cho to√†n App ƒë·ªÉ ƒë·∫øm t·ªïng s·ªë request
    private int totalCalls = 0;
    public synchronized void increment() { totalCalls++; }
}

@Component
@Scope(&quot;prototype&quot;)
public class DataExporter {
    // M·ªói l·∫ßn export m·ªôt file Excel, ta c·∫ßn m·ªôt &quot;th·∫±ng th·ª£&quot; m·ªõi 
    // ƒë·ªÉ kh√¥ng b·ªã l·∫´n l·ªôn d·ªØ li·ªáu gi·ªØa c√°c file
    public void export(List&lt;?&gt; data) { /* logic */ }
}
</code></pre>
<h4>B. Request Scope: L∆∞u th√¥ng tin User t·ª´ Token</h4>
<p>ƒê√¢y l√† c√°ch c·ª±c hay ƒë·ªÉ b·∫°n kh√¥ng ph·∫£i truy·ªÅn <code>userId</code> qua t·ª´ng h√†m trong Service.</p>
<pre><code class="language-java">@Component
@WebScope // T∆∞∆°ng ƒë∆∞∆°ng @Scope(value = WebApplicationContext.SCOPE_REQUEST, proxyMode = ScopedProxyMode.TARGET_CLASS)
public class UserContext {
    private String currentUsername;
    private String userIp;

    // Getters/Setters...
}

// C√°ch d√πng trong Filter (Tr√≠ch xu·∫•t t·ª´ JWT)
@Component
public class JwtFilter extends OncePerRequestFilter {
    @Autowired private UserContext userContext;

    @Override
    protected void doFilterInternal(...) {
        String username = extractUsername(request); 
        userContext.setCurrentUsername(username); // Ch·ªâ c√≥ t√°c d·ª•ng trong request n√†y
        chain.doFilter(request, response);
    }
}
</code></pre>
<hr>
<h3>3. T√¨nh hu·ªëng th·ª±c t·∫ø (Real-world Scenarios)</h3>
<p><strong>T√¨nh hu·ªëng 1: Singleton - &quot;C√°i ph·ªÖu&quot; t·∫≠p trung d·ªØ li·ªáu</strong></p>
<ul>
<li><strong>V·∫•n ƒë·ªÅ:</strong> B·∫°n c·∫ßn m·ªôt b·ªô nh·ªõ ƒë·ªám (In-memory Cache) ƒë·ªÉ l∆∞u danh s√°ch c√°c t·ªânh th√†nh Vi·ªát Nam (√≠t thay ƒë·ªïi).</li>
<li><strong>Gi·∫£i ph√°p:</strong> D√πng <strong>Singleton</strong>. D·ªØ li·ªáu ƒë∆∞·ª£c n·∫°p 1 l·∫ßn duy nh·∫•t khi Server kh·ªüi ƒë·ªông. T·∫•t c·∫£ ng∆∞·ªùi d√πng ƒë·ªÅu truy c·∫≠p v√†o c√πng m·ªôt danh s√°ch n√†y, gi√∫p ti·∫øt ki·ªám RAM v√† kh√¥ng ph·∫£i g·ªçi Database li√™n t·ª•c.</li>
</ul>
<p><strong>T√¨nh hu·ªëng 2: Request Scope - &quot;Chi·∫øc h·ªôp&quot; b√≠ m·∫≠t c·ªßa m·ªói y√™u c·∫ßu</strong></p>
<ul>
<li><strong>V·∫•n ƒë·ªÅ:</strong> B·∫°n mu·ªën ghi Log cho m·ªói API bao g·ªìm: <code>TimeStart</code>, <code>UserId</code>, <code>Action</code>, <code>Duration</code>. N·∫øu d√πng Singleton, d·ªØ li·ªáu c√°c Request ch·∫°y song song s·∫Ω ƒë√® l√™n nhau.</li>
<li><strong>Gi·∫£i ph√°p:</strong> D√πng <strong>Request Scope</strong>. Khi Request A v√†o, Spring t·∫°o m·ªôt <code>LogContext</code>. Khi Request B v√†o, Spring t·∫°o m·ªôt <code>LogContext</code> kh√°c. Hai c√°i n√†y ho√†n to√†n ƒë·ªôc l·∫≠p. Cu·ªëi Request, b·∫°n l·∫•y d·ªØ li·ªáu ra ghi v√†o DB/File.</li>
</ul>
<p><strong>T√¨nh hu·ªëng 3: Gi·∫£i quy·∫øt b√†i to√°n &quot;Singleton inject Prototype&quot; (B√†i to√°n kh√≥)</strong></p>
<ul>
<li><strong>V·∫•n ƒë·ªÅ:</strong> M·ªôt <code>OrderService</code> (Singleton) c·∫ßn g·ªçi m·ªôt <code>ImageProcessor</code> (Prototype). V√¨ <code>OrderService</code> ch·ªâ kh·ªüi t·∫°o 1 l·∫ßn, n√™n n√≥ c≈©ng ch·ªâ ƒë∆∞·ª£c &quot;ti√™m&quot; <code>ImageProcessor</code> ƒë√∫ng 1 l·∫ßn. K·∫øt qu·∫£ l√† <code>ImageProcessor</code> v√¥ t√¨nh tr·ªü th√†nh Singleton!</li>
<li><strong>Gi·∫£i ph√°p (Code m·∫´u):</strong> D√πng <code>ObjectProvider</code>.</li>
</ul>
<pre><code class="language-java">@Service
public class OrderService {
    // Thay v√¨ @Autowired tr·ª±c ti·∫øp ImageProcessor
    @Autowired
    private ObjectProvider&lt;ImageProcessor&gt; imageProcessorProvider;

    public void processOrder() {
        // M·ªói l·∫ßn g·ªçi .getIfAvailable(), Spring s·∫Ω t·∫°o 1 instance Prototype m·ªõi
        ImageProcessor processor = imageProcessorProvider.getIfAvailable();
        processor.handle();
    }
}
</code></pre>
<hr>
<h3>T√≥m t·∫Øt so s√°nh cho Dev Frontend</h3>
<table>
<thead>
<tr>
<th>Scope</th>
<th>T∆∞∆°ng ·ª©ng trong Frontend</th>
<th>L∆∞u √Ω quan tr·ªçng</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Singleton</strong></td>
<td>Redux Store / Global Variable</td>
<td>Kh√¥ng ƒë∆∞·ª£c l∆∞u d·ªØ li·ªáu ri√™ng c·ªßa User v√†o ƒë√¢y.</td>
</tr>
<tr>
<td><strong>Prototype</strong></td>
<td><code>new ClassName()</code> m·ªói khi c·∫ßn</td>
<td>Spring kh√¥ng qu·∫£n l√Ω vi·ªác h·ªßy Bean n√†y (c·∫©n th·∫≠n memory leak).</td>
</tr>
<tr>
<td><strong>Request</strong></td>
<td>M·ªôt bi·∫øn trong h√†m <code>useEffect</code></td>
<td>R·∫•t h·ªØu √≠ch ƒë·ªÉ l√†m Audit Log ho·∫∑c Multi-tenancy.</td>
</tr>
<tr>
<td><strong>Session</strong></td>
<td><code>sessionStorage</code></td>
<td>T·ªën RAM Server v√¨ ph·∫£i gi·ªØ Object ch·ªù ng∆∞·ªùi d√πng.</td>
</tr>
</tbody></table>
<hr>
<h3>B√†i t·∫≠p nh·ªè cho b·∫°n:</h3>
<p>N·∫øu b·∫°n l√†m m·ªôt trang <strong>Gi·ªè h√†ng (Shopping Cart)</strong> cho Web truy·ªÅn th·ªëng (kh√¥ng d√πng LocalStorage ·ªü App), b·∫°n s·∫Ω ch·ªçn Scope n√†o cho <code>CartBean</code>?</p>
<ol>
<li>Singleton</li>
<li>Prototype</li>
<li>Session</li>
<li>Request</li>
</ol>
<h2><em>(G·ª£i √Ω: Gi·ªè h√†ng c·∫ßn t·ªìn t·∫°i khi user chuy·ªÉn t·ª´ trang n√†y sang trang kh√°c nh∆∞ng m·ªói user ph·∫£i c√≥ gi·ªè h√†ng ri√™ng).</em></h2>

          </article>

          <!-- Navigation Footer (Next/Prev) -->
          <div class="mt-12 pt-8 border-t border-gray-200 flex justify-between">
            <a href="topic01.html" class="text-indigo-600 font-medium hover:text-indigo-800">‚Üê Ch·ªß ƒë·ªÅ 1: Request-Response Cycle & The Middleware Chain</a><a href="topic03.html" class="text-indigo-600 font-medium hover:text-indigo-800">Ch·ªß ƒë·ªÅ 3: Persistence v·ªõi Spring Data JPA & Hibernate ‚Üí</a>
          </div>
        </div>
      </main>
    </div>

    <!-- Overlay for mobile sidebar -->
    <div
      onclick="toggleSidebar()"
      id="overlay"
      class="fixed inset-0 bg-black/50 z-10 lg:hidden hidden"
      style="display: none"
    ></div>
    <script>
      // Simple overlay logic
      const sidebar = document.getElementById("sidebar");
      const overlay = document.getElementById("overlay");

      // Sync overlay with sidebar state check if needed, but for "simplest" just toggle visibility in CSS or JS.
      // Actually, let's keep it simple.
    </script>
  </body>
</html>
